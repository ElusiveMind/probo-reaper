#! /usr/bin/env node

var path = require('path'),
    util = require('util'),
    fs = require('fs')

var Loader = require('yaml-config-loader')
var yargs = require('yargs')
var loader = new Loader()

var reaper = require('../lib/reaper')

loader.on('error', function(error){
  if (error.name === 'YAMLException') {
    console.error(util.print('Error parsing YAML file `', error.filePath, '`:', error.reason))
    console.log(error)
  }
})



var argv = yargs
  .describe('config', 'A YAML config file or directory of yaml files to load, can be invoked multiple times and later files will override earlier.')
  .alias('config', 'c')
  .argv

loader.add(path.resolve(path.join(__dirname, '..', 'defaults.yaml')))
loader.addAndNormalizeObject(process.env)

var commandName = argv._[0]

loader.load(function(err, config){
  if(err){
    console.error(err)
    process.exit(1)
  }

  reaper.run(config)
})